<launch>
  <arg name="x" default="0" />
  <arg name="y" default="0" />
  <!-- robot dependent height -->
  <arg name="z" default="0.4" />
  <arg name="base_link_height_to_ground" default="0.06349" />
  <!--  -->
  <arg name="yaw" default="0.0" />
  <arg name="world_filepath" default="$(find jackal_gazebo)/worlds/jackal_race_top_down.world" />

  <!-- if you want to spawn robot at non origin and use mapping packages to publish map to map_frame -->
  <arg name="world_frame" default="map" />
  <arg name="map_frame" default="map_link" />

  <arg name="scan_topic" default="/front/scan"/>
  <arg name="gazebo_odom_topic" default="/gazebo_p3d/odom" />

	<!-- Spawn the World ERL -->
  <!-- <include file="$(find erl_models)/launch/spawn_world.launch">
    <arg name="world" value="iros2017_corridor"/> 
    <arg name="world_frame" value="$(arg world_frame)"/>
    <arg name="scale" value="1"/>
    <arg name="gui" value="false"/>
  </include> -->

  <!-- Launch Gazebo with the specified world -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="debug" value="0" />
    <arg name="gui" value="true" />
    <arg name="use_sim_time" value="true" />
    <arg name="headless" value="true" />
    <arg name="world_name" value="$(arg world_filepath)" />
  </include>  

  <!-- world to map (map_link generated by hector slam) -->
  <!-- args x y z yaw pitch roll -->
  <node pkg="tf2_ros" type="static_transform_publisher" name="world_map_transformer"
    args="$(arg x) $(arg y) $(arg base_link_height_to_ground) 0 0 0 $(arg world_frame) $(arg map_frame)"/>

  <!-- <node pkg="tf2_ros" type="static_transform_publisher" name="idendity_map" args="0 0 0 0 0 0 1 scanmatcher_frame base_link"/> -->

  <!-- Configuration of Jackal which you would like to simulate. See jackal_description for details. -->
  <!-- Spawn Jackal -->
  <include file="$(find jackal_gazebo)/launch/spawn_jackal.launch">
    <arg name="x" value="$(arg x)" />
    <arg name="y" value="$(arg y)" />
    <arg name="z" value="$(arg z)" />
    <arg name="yaw" value="$(arg yaw)" />
    <arg name="config" value="front_laser" />
    <arg name="joystick" value="true" />
    <arg name="keyboard" default="false" />
    <arg name="enable_ekf" default="false" />
  </include>

  <node pkg="gazebo_p3d_utils" type="p3d_link_tf_complex" name="link_local_map_to_base_link"  output="screen">
    <remap from="~input" to="$(arg gazebo_odom_topic)"/>
    <param name="global_map_frame_id" value="$(arg world_frame)"/>
    <param name="local_map_frame_id" value="$(arg map_frame)"/>
  </node>

  <!-- need this to link scanmatcher_frame to base_link -->
  <!-- <node pkg="tf2_ros" type="static_transform_publisher" name="idendity_map" args="0 0 0 0 0 0 1 scanmatcher_frame base_link"/> -->

  <!-- slam hector as mapping and localization does not use external odom-->
  <include file="$(find jackal_gazebo)/launch/jackal_hector_map.launch">
    <arg name="scan_topic" value="front/scan" />
    <arg name="map_size" value="512" />
    <arg name="map_resolution" value="0.1" />
    <arg name="map_frame" value="$(arg map_frame)" />
    <arg name="map_start_x" default="0.5"/>
    <arg name="map_start_y" default="0.5"/>
  </include>

  <!-- A* node with ground truth odom-->
  <include file="$(find erl_astar_ros)/launch/erl_astar_2d_node.launch">
    <arg name="inflation_value" value="0.2" />
    <arg name="planning_frame" value="$(arg map_frame)" />
    <arg name="odom_topic" value="$(arg gazebo_odom_topic)" />

  </include>



  <!--- Run rviz using config inside package -->
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find erl_astar_ros)/rviz/test_jackal_astar_2d.rviz" />

</launch>
